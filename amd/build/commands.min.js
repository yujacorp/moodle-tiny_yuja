define("tiny_yuja/commands",["exports","editor_tiny/utils","core/str","./common","./options","editor_tiny/loader"],(function(_exports,_utils,_str,_common,_options,_loader){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.getSetup=void 0;
/**
   * Commands helper for tiny_yuja
   *
   * @module      tiny_yuja/commands
   * @copyright   2023 yuja
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
function loadScript(url){var script=document.createElement("script");script.src=url;(document.body||document.head||document.documentElement).appendChild(script)}function showAlertMessage(title,message){var $=$||jQuery;var ID_TOAST_CONTAINER="toastMessageContainer";var ID_TOAST_STYLES="yujaToastMessageStyles";var CLASS_YUJA_TOASTS="yuja-toast-message";var TOAST_MESSAGE_LIFETIME_MS=3e3;var TOAST_FADE_OUT_DURATION_MS=1e3;var ID_YUJA_TOAST=CLASS_YUJA_TOASTS;function helperIdToCssSelector(id){return"#"+(id||"")}function helperIDExists(id){return $(helperIdToCssSelector(id)).length===1}function createSingletonToastMessageContainer(){if(!helperIDExists(ID_TOAST_CONTAINER)){var $idToastContainer=$("<div>").attr("id",ID_TOAST_CONTAINER);$(document.body).append($idToastContainer)}}function createSingletonToastMessageStyles(){if(!helperIDExists(ID_TOAST_STYLES)){var styles=[];styles.push(""+"#toastMessageContainer{\n"+"    position: absolute;\n"+"    left: 0;\n"+"    right: 0;\n"+"    margin: 0 auto;\n"+"    z-index: 9999;\n"+"    width: 420px;\n"+"    top: 50px;\n"+"}\n");styles.push(""+".yuja-toast-message {\n"+"    background-image: "+'url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNC'+"SVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBl"+"Lm9yZ5vuPBoAAARkSURBVEiJhZZNbFRVFMd/577XDwTiQg3YvuEjRYMLo6nsWAmRGJB2Os82CExbMVEx"+"UVGhdWEMLEzAamtiNLoQ6BRYNDMtI9YFiZJA3GHEGKMxpLbMTGvCwg+0rZ1597h4b0o/pniSSW7u+d//"+"/5zzv7lvhDtEarBunTqmWWAXwgYUDwAhjzImyhdF12YPxCdyy3FIpc3+Qa9eHN4GngOcOxUBWJBMYJyu"+"Z1vGxv5XYCAdi6voALAKmAUdRsx5KQXf6UyQB5Bax8M4jdYQF9U4UA3cEmR/0s99vqzAQNp7VYVewAik"+"DaZ7n39j9E7lnx6ONThWexRaAKtwqMPPf7hEIKo8A6iqdHU8netd0t2Q1w2QTORPLM71p70jIhwPSaWl"+"3IkAnMnUexb5KRyLHG73c+8vJa9/RFWuAYjoo8lE4fvFmFTG6wJOALeqXNn8THNuwgBYkWPAKoF0JfIw"+"zGvllSqHKiHa/fy7wHlgdbGoRwEkNVi3DseMAoGDeajSzAcy6+9Xgl8BN9oqCc7GpD8+uQQ76G1Shx8B"+"x6Ab3OieO6Dpff6N0VODG9Y6bmm36G1/lNLjIDVAJtrylVLvQMa7NIcRNCi5F5JtY9dTmVgWtNWKaXYF"+"dgKImiyA6wbHVenQBXWFWhbbB2AwPsgehT1zEAXXDfqBThHNqtKK6k4X2BQe0qsAgXLSQCtwF/APyjkE"+"RfTnzsTENwCpofrXUdms4XXeG2GnAuVkOEB7FceA0GCAtQBV9t9JgE4/d1msPAn8DazE4Iz+kD/Ynij0"+"zZmZKPQlE/kXBS2WyY3Vpk4/dxmghmIh6qreLDYJINmau4JoMzCFcqDh4djHS8wc8j4BOQhMKfrU/tbC"+"V+Xc7OzdJhKwBpgAmHar6+YTtCcKXxurTSFOX+gfqr+nnDt3oe5e4HkAY7Wpwy9cmn+2WDtVF1k34QKj"+"wIPGmseAX+YD1ejvocE6tqJU+GNgKHYYwJ3O9ZUcbxxYH2IWhsFsiZajRpQRAGuILwaqmh3hSq7NON5F"+"Ve1R1Z4Zx7uIci1MmSeWCAjNYecyYoquzQKBqMZPD8caFiCF8uFmYBvwW/TbhhCOT9kx/8jZtPeAhvgS"+"gWbNgfhETuEUUO1Y7SkDU6k1K4Gtc1LCFcFpFJxGhCvcfii3RlhUkQB6gCpBPutoyxdCtwOOArcUWvrT"+"3hEAVlVtAWrCWUnf9M0125P++GTSH5+cvrlmOyrla1sTYRnIeN2E4/kTzDGY/1xnYk2KDkeVvOnM1H5q"+"V8z0InzZnsgPLZ4zQGrIS6DsrA2q35gxswcR3glJtSnpF0YWCAD0Z7yXBT4IfWKYgK5kW/56JfL5My+J"+"vidIE2AReaU9kfuonF/yyUyl63Yj5iywGiiCnBfRbMnab1faYh5gxnVjgtOIEo8MrUL5S0T3litfVgDg"+"5ODa+1zjvoXwEref6OXCAmcFp7vS811RoBxnMvWeFdMsVnepsBGivy2QB0YVGSHQbEdbvrAcx3+/BcsB"+'IawLQwAAAABJRU5ErkJggg==") !important;\n'+"    background-repeat: no-repeat;\n"+"    background-position: 15px center;\n"+"    background-color: white;\n"+"    padding: 15px;\n"+"    -moz-border-radius: 3px 3px 3px 3px;\n"+"    -webkit-border-radius: 3px 3px 3px 3px;\n"+"    border-radius: 3px 3px 3px 3px;\n"+"    -moz-box-shadow: 0 0 12px #999999;\n"+"    -webkit-box-shadow: 0 0 12px #999999;\n"+"    box-shadow: 0 0 12px #999999;\n"+"    opacity: 0.95;\n"+"    -ms-filter: progid:DXImageTransform.Microsoft.Alpha(Opacity=80);\n"+"    filter: alpha(opacity=80);\n"+"    position: relative;\n"+"    cursor: pointer;\n"+"}");styles.push(""+".message-container {\n"+"    padding-left: 25px;\n"+"}");styles.push(""+".message-content {\n"+"    padding-left: 15px;\n"+"}");styles.push(""+".header {\n"+"    font-weight: bold;\n"+"    font-size: 15px;\n"+"    color: #A2AD1C;\n"+"}\n");styles.push(""+".left-side-border{\n"+'    content: url("data:image/png;base64,'+"/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAAAAD/4QMxaHR0cDovL25zLmFkb2Jl"+"LmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/"+"PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYt"+"YzEzOCA3OS4xNTk4MjQsIDIwMTYvMDkvMTQtMDE6MDk6MDEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0i"+"aHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRm"+"OmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6eG1wTU09Imh0"+"dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hh"+"cC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE3"+"IChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjU1MTM3NzE3QkE4MzExRTc5RDFBQ0QzQTA5"+"NDIwQkI2IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjU1MTM3NzE4QkE4MzExRTc5RDFBQ0QzQTA5NDIwQkI2"+"Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NTUxMzc3MTVCQTgzMTFFNzlE"+"MUFDRDNBMDk0MjBCQjYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NTUxMzc3MTZCQTgzMTFFNzlEMUFDRDNB"+"MDk0MjBCQjYiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBl"+"bmQ9InIiPz7/7gAOQWRvYmUAZMAAAAAB/9sAhAAbGhopHSlBJiZBQi8vL0JHPz4+P0dHR0dHR0dHR0dHR0dHR0dH"+"R0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHAR0pKTQmND8oKD9HPzU/R0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dH"+"R0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0f/wAARCABKAAUDASIAAhEBAxEB/8QAZwABAAMBAAAAAAAAAAAAAAAA"+"AAMEBQIBAQEBAQAAAAAAAAAAAAAAAAQCAwUQAQACAQUBAAAAAAAAAAAAAAABYRORoQISUhQRAAECBQUBAAAAAAAA"+"AAAAAAABEyFhAhJS8JGh4SIU/9oADAMBAAIRAxEAPwDUGbk4+o1gR8qZcdhXqsdbGZ0kXfl50F3Dm0ma+KaEmSBy"+'Hq5GsSlnrcUM1CmxNqEHao3HIZAn1M//2Q==");\n'+"    width: 5px;\n"+"    height: 100%;\n"+"    position: absolute;\n"+"    top: 0;\n"+"    left: 0;"+"}\n");styles.push(""+".toast-lifetime-progress {\n"+"    position: absolute;\n"+"    top: 0;\n"+"    left: 0;\n"+"    width: 0;\n"+"    transition: width 3s, background-color 3s;\n"+"    height: 5px;\n"+"    background-color: #73ff04;\n"+"}");styles.push(""+".toast-lifetime-progress.start-animation {\n"+"    background-color: #ff0005;\n"+"    width: 100%;\n"+"}");var $toastMesageStyles=$("<style>").attr("id",ID_TOAST_STYLES).append(styles);$(document.head).append($toastMesageStyles)}}function getNextAvailableToastMessageUniqueID(){var nextUniqueId=$("."+CLASS_YUJA_TOASTS).length+1;return ID_YUJA_TOAST+"-"+nextUniqueId}function helperConstructMessage(){var $leftSideBar=$("<div>").attr("class","left-side-border");var $progressBar=$("<div>").attr("class","toast-lifetime-progress");var $header=$("<div>").attr("class","message-content header").append(title);var $body=$("<div>").attr("class","message-content body").append(message);return $("<div>").attr("class","message-container").append($progressBar).append($leftSideBar).append($header).append($body)}function killToastMessage($toast){return function(){if($toast.length===1){$toast.css({display:"none"})}}}function fadeAndKillToastMessage(newToastId){return function(){var $toast=$(helperIdToCssSelector(newToastId));if($toast.length===1){$toast.css({transition:"opacity "+TOAST_FADE_OUT_DURATION_MS+"ms",opacity:"0"});setTimeout(killToastMessage($toast),TOAST_FADE_OUT_DURATION_MS)}}}function createToastMessage(){createSingletonToastMessageContainer();createSingletonToastMessageStyles();var newToastId=getNextAvailableToastMessageUniqueID();var $toastContainer=$(helperIdToCssSelector(ID_TOAST_CONTAINER));if($toastContainer.length===1){$toastContainer.append($("<div>").attr("id",newToastId).attr("class",CLASS_YUJA_TOASTS).on("click",function(){killToastMessage($(helperIdToCssSelector(newToastId)))}).append(helperConstructMessage()));setTimeout(function(){if($toastContainer.length===1){$toastContainer.find(helperIdToCssSelector(newToastId)).find(".toast-lifetime-progress").addClass("start-animation")}},25);setTimeout(fadeAndKillToastMessage(newToastId),TOAST_MESSAGE_LIFETIME_MS)}}createToastMessage()}const handleAction=editor=>{var mediaSelector=null;var params=JSON.parse(document.getElementById('urldata').value);if (params.error !== undefined && params.error !== null) {showAlertMessage("Error", 'The YuJa media chooser experienced an error.  Please ensure your configuration information is correct and try refreshing the page. If the error persists, please contact YuJa support.');return;}var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}var yujaConnectedCallback=null;xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==XMLHttpRequest.DONE){if(xmlhttp.status==200){try{params.videos=JSON.parse(xmlhttp.responseText)}catch(err){params.videos={success:false}}}else{params.videos={success:false}}isYujaConnected = false;if(params.videos!==undefined&&params.videos.success===false){showAlertMessage("Loading...",'The YuJa media chooser experienced an error while loading videos.  Please ensure your configuration information is correct and try refreshing the page. If the error persists, please contact YuJa support.');return;}if(mediaSelector===null){mediaSelector=yuja.createMediaSelector(params.videos.data)}mediaSelector.onSelect(function(embedString){var editorcontents = editor.getContent();var arrayofIframe = editorcontents.split("<iframe"); var splitembedString = embedString.split(" ");var currentURL = embedString.match(/https?:\/\/[^\s]+/)[0];const urlParams = new URLSearchParams(currentURL);const auth = urlParams.get('a');var error = false;arrayofIframe.forEach(function(item,index){if(item.includes(splitembedString[1].match(/\d/g).join("")) && item.includes(splitembedString[2].match(/\d/g).join("")) && item.includes(auth)){error = true;}});if(!error){editor.execCommand('mceInsertContent', false, embedString);}});mediaSelector.open();}};var error=false;if(!isYujaConnected){isYujaConnected=true;loadScript(params.yujaJsUrl);xmlhttp.open("GET",params.yujaVideosUrl,true);xmlhttp.send();error=true;}else if (params.videos === undefined || (typeof yuja === "undefined" || yuja === undefined)) {showAlertMessage("Loading...", 'The YuJa media chooser is still loading your YuJa content. Try again in a few seconds.');return;}};var isYujaConnected = false;_exports.getSetup=async()=>{const[buttonTitle,buttonImage,tinyMCE]=await Promise.all([(0,_str.get_string)("buttonTitle",_common.component),(0,_utils.getButtonImage)("icon",_common.component),(0,_loader.getTinyMCE)()]);tinyMCE.PluginManager.requireLangPack("yuja");return editor=>{editor.ui.registry.addIcon(_common.icon,buttonImage.html);editor.ui.registry.addButton(_common.buttonName,{icon:_common.icon,tooltip:buttonTitle,onAction:()=>handleAction(editor)});editor.ui.registry.addMenuItem(_common.buttonName,{icon:_common.icon,text:buttonTitle,onAction:()=>handleAction(editor)})}};}));

//# sourceMappingURL=commands.min.js.map