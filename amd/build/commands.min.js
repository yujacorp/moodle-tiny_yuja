define("tiny_yuja/commands",["exports","core/str","editor_tiny/utils","editor_tiny/loader","./common","./options"],(function(_exports,_str,_utils,_loader,_common,_options){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.getSetup=void 0;
/**
   * YuJa Plugin for Moodle Tiny
   * @module     tiny_yuja/commands
   * @copyright  2023 YuJa
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
var handlerLoaded=!1;function embedHandler(editor,embedString){var arrayofIframe=editor.getContent().split("<iframe"),splitembedString=embedString.split(" "),currentURL=embedString.match(/https?:\/\/[^\s]+/)[0];const auth=new URLSearchParams(currentURL).get("a");var error=!1;arrayofIframe.forEach((function(item,index){item.includes(splitembedString[1].match(/\d/g).join(""))&&item.includes(splitembedString[2].match(/\d/g).join(""))&&item.includes(auth)&&(error=!0)})),error||editor.execCommand("mceInsertContent",!1,embedString)}function showAlertMessage(title,message){var $=$||jQuery;function helperIdToCssSelector(id){return"#"+(id||"")}function helperIDExists(id){return 1===$(helperIdToCssSelector(id)).length}function killToastMessage($toast){return function(){1===$toast.length&&$toast.css({display:"none"})}}!function(){!function(){if(!helperIDExists("toastMessageContainer")){var $idToastContainer=$("<div>").attr("id","toastMessageContainer");$(document.body).append($idToastContainer)}}(),function(){if(!helperIDExists("yujaToastMessageStyles")){var styles=[];styles.push("#toastMessageContainer{\n    position: absolute;\n    left: 0;\n    right: 0;\n    margin: 0 auto;\n    z-index: 9999;\n    width: 420px;\n    top: 50px;\n}\n"),styles.push('.yuja-toast-message {\n    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAARkSURBVEiJhZZNbFRVFMd/577XDwTiQg3YvuEjRYMLo6nsWAmRGJB2Os82CExbMVExUVGhdWEMLEzAamtiNLoQ6BRYNDMtI9YFiZJA3GHEGKMxpLbMTGvCwg+0rZ1597h4b0o/pniSSW7u+d///5zzv7lvhDtEarBunTqmWWAXwgYUDwAhjzImyhdF12YPxCdyy3FIpc3+Qa9eHN4GngOcOxUBWJBMYJyuZ1vGxv5XYCAdi6voALAKmAUdRsx5KQXf6UyQB5Bax8M4jdYQF9U4UA3cEmR/0s99vqzAQNp7VYVewAikDaZ7n39j9E7lnx6ONThWexRaAKtwqMPPf7hEIKo8A6iqdHU8netd0t2Q1w2QTORPLM71p70jIhwPSaWl3IkAnMnUexb5KRyLHG73c+8vJa9/RFWuAYjoo8lE4fvFmFTG6wJOALeqXNn8THNuwgBYkWPAKoF0JfIwzGvllSqHKiHa/fy7wHlgdbGoRwEkNVi3DseMAoGDeajSzAcy6+9Xgl8BN9oqCc7GpD8+uQQ76G1Shx8Bx6Ab3OieO6Dpff6N0VODG9Y6bmm36G1/lNLjIDVAJtrylVLvQMa7NIcRNCi5F5JtY9dTmVgWtNWKaXYFdgKImiyA6wbHVenQBXWFWhbbB2AwPsgehT1zEAXXDfqBThHNqtKK6k4X2BQe0qsAgXLSQCtwF/APyjkERfTnzsTENwCpofrXUdms4XXeG2GnAuVkOEB7FceA0GCAtQBV9t9JgE4/d1msPAn8DazE4Iz+kD/Ynij0zZmZKPQlE/kXBS2WyY3Vpk4/dxmghmIh6qreLDYJINmau4JoMzCFcqDh4djHS8wc8j4BOQhMKfrU/tbCV+Xc7OzdJhKwBpgAmHar6+YTtCcKXxurTSFOX+gfqr+nnDt3oe5e4HkAY7Wpwy9cmn+2WDtVF1k34QKjwIPGmseAX+YD1ejvocE6tqJU+GNgKHYYwJ3O9ZUcbxxYH2IWhsFsiZajRpQRAGuILwaqmh3hSq7NON5FVe1R1Z4Zx7uIci1MmSeWCAjNYecyYoquzQKBqMZPD8caFiCF8uFmYBvwW/TbhhCOT9kx/8jZtPeAhvgSgWbNgfhETuEUUO1Y7SkDU6k1K4Gtc1LCFcFpFJxGhCvcfii3RlhUkQB6gCpBPutoyxdCtwOOArcUWvrT3hEAVlVtAWrCWUnf9M0125P++GTSH5+cvrlmOyrla1sTYRnIeN2E4/kTzDGY/1xnYk2KDkeVvOnM1H5qV8z0InzZnsgPLZ4zQGrIS6DsrA2q35gxswcR3glJtSnpF0YWCAD0Z7yXBT4IfWKYgK5kW/56JfL5My+JvidIE2AReaU9kfuonF/yyUyl63Yj5iywGiiCnBfRbMnab1faYh5gxnVjgtOIEo8MrUL5S0T3litfVgDg5ODa+1zjvoXwEref6OXCAmcFp7vS811RoBxnMvWeFdMsVnepsBGivy2QB0YVGSHQbEdbvrAcx3+/BcsBIawLQwAAAABJRU5ErkJggg==") !important;\n    background-repeat: no-repeat;\n    background-position: 15px center;\n    background-color: white;\n    padding: 15px;\n    -moz-border-radius: 3px 3px 3px 3px;\n    -webkit-border-radius: 3px 3px 3px 3px;\n    border-radius: 3px 3px 3px 3px;\n    -moz-box-shadow: 0 0 12px #999999;\n    -webkit-box-shadow: 0 0 12px #999999;\n    box-shadow: 0 0 12px #999999;\n    opacity: 0.95;\n    -ms-filter: progid:DXImageTransform.Microsoft.Alpha(Opacity=80);\n    filter: alpha(opacity=80);\n    position: relative;\n    cursor: pointer;\n}'),styles.push(".message-container {\n    padding-left: 25px;\n}"),styles.push(".message-content {\n    padding-left: 15px;\n}"),styles.push(".header {\n    font-weight: bold;\n    font-size: 15px;\n    color: #A2AD1C;\n}\n"),styles.push('.left-side-border{\n    content: url("data:image/png;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAAAAD/4QMxaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzEzOCA3OS4xNTk4MjQsIDIwMTYvMDkvMTQtMDE6MDk6MDEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE3IChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjU1MTM3NzE3QkE4MzExRTc5RDFBQ0QzQTA5NDIwQkI2IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjU1MTM3NzE4QkE4MzExRTc5RDFBQ0QzQTA5NDIwQkI2Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NTUxMzc3MTVCQTgzMTFFNzlEMUFDRDNBMDk0MjBCQjYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NTUxMzc3MTZCQTgzMTFFNzlEMUFDRDNBMDk0MjBCQjYiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7/7gAOQWRvYmUAZMAAAAAB/9sAhAAbGhopHSlBJiZBQi8vL0JHPz4+P0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHAR0pKTQmND8oKD9HPzU/R0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0f/wAARCABKAAUDASIAAhEBAxEB/8QAZwABAAMBAAAAAAAAAAAAAAAAAAMEBQIBAQEBAQAAAAAAAAAAAAAAAAQCAwUQAQACAQUBAAAAAAAAAAAAAAABYRORoQISUhQRAAECBQUBAAAAAAAAAAAAAAABEyFhAhJS8JGh4SIU/9oADAMBAAIRAxEAPwDUGbk4+o1gR8qZcdhXqsdbGZ0kXfl50F3Dm0ma+KaEmSByHq5GsSlnrcUM1CmxNqEHao3HIZAn1M//2Q==");\n    width: 5px;\n    height: 100%;\n    position: absolute;\n    top: 0;\n    left: 0;}\n'),styles.push(".toast-lifetime-progress {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0;\n    transition: width 3s, background-color 3s;\n    height: 5px;\n    background-color: #73ff04;\n}"),styles.push(".toast-lifetime-progress.start-animation {\n    background-color: #ff0005;\n    width: 100%;\n}");var $toastMesageStyles=$("<style>").attr("id","yujaToastMessageStyles").append(styles);$(document.head).append($toastMesageStyles)}}();var $leftSideBar,$progressBar,$header,$body,newToastId="yuja-toast-message-"+($(".yuja-toast-message").length+1),$toastContainer=$(helperIdToCssSelector("toastMessageContainer"));1===$toastContainer.length&&($toastContainer.append($("<div>").attr("id",newToastId).attr("class","yuja-toast-message").on("click",(function(){killToastMessage($(helperIdToCssSelector(newToastId)))})).append(($leftSideBar=$("<div>").attr("class","left-side-border"),$progressBar=$("<div>").attr("class","toast-lifetime-progress"),$header=$("<div>").attr("class","message-content header").append(title),$body=$("<div>").attr("class","message-content body").append(message),$("<div>").attr("class","message-container").append($progressBar).append($leftSideBar).append($header).append($body)))),setTimeout((function(){1===$toastContainer.length&&$toastContainer.find(helperIdToCssSelector(newToastId)).find(".toast-lifetime-progress").addClass("start-animation")}),25),setTimeout(function(newToastId){return function(){var $toast=$(helperIdToCssSelector(newToastId));1===$toast.length&&($toast.css({transition:"opacity 1000ms",opacity:"0"}),setTimeout(killToastMessage($toast),1e3))}}(newToastId),3e3))}()}const handleAction=editor=>{var mediaSelector=null,params=JSON.parse(document.getElementById("urldata").value);if("1.3"!=params.ltiVersion)if(void 0===params.yujaError||null===params.yujaError){var xmlhttp;(xmlhttp=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).onreadystatechange=function(){if(xmlhttp.readyState==XMLHttpRequest.DONE){if(200==xmlhttp.status)try{params.videos=JSON.parse(xmlhttp.responseText)}catch(err){params.videos={success:!1}}else params.videos={success:!1};if(isYujaConnected=!1,void 0!==params.videos&&!1===params.videos.success)return void showAlertMessage("Loading...","The YuJa media chooser experienced an error while loading videos.  Please ensure your configuration information is correct and try refreshing the page. If the error persists, please contact YuJa support.");null===mediaSelector&&(mediaSelector=yuja.createMediaSelector(params.videos.data)),mediaSelector.onSelect(embedHandler.bind(null,editor)),mediaSelector.open()}};var url,script;if(isYujaConnected){if(void 0===params.videos||"undefined"==typeof yuja||void 0===yuja)return void showAlertMessage("Loading...","The YuJa media chooser is still loading your YuJa content. Try again in a few seconds.")}else isYujaConnected=!0,url=params.yujaJsUrl,(script=document.createElement("script")).src=url,(document.body||document.head||document.documentElement).appendChild(script),xmlhttp.open("GET",params.yujaVideosUrl,!0),xmlhttp.send(),!0}else showAlertMessage("Error","The YuJa media chooser experienced an error.  Please ensure your configuration information is correct and try refreshing the page. If the error persists, please contact YuJa support.");else!function(url,editor){var script=document.createElement("script");script.onload=function(){require(["jquery"],(function($){if($("#yujaVideoChooserIFrame").attr("src",url),!handlerLoaded){function OnMessage(event){if("getVideo"==event.data.type){var embedString=event.data.embed;embedHandler(editor,embedString),require(["jquery"],(function($){$(".yuja-overlay").removeClass("yuja-overlay-visible"),$("#yujaVideoChooserIFrame").attr("src","")}))}}window.addEventListener?window.addEventListener("message",OnMessage,!1):window.attachEvent&&window.attachEvent("onmessage",OnMessage),handlerLoaded=!0}}))},script.src=location.origin+"/local/yuja/media_selection.js",(document.body||document.head||document.documentElement).appendChild(script)}(params.lti3LoginInitUrl,editor)};var isYujaConnected=!1;_exports.getSetup=async()=>{const[buttonTitle,buttonImage,tinyMCE]=await Promise.all([(0,_str.get_string)("buttonTitle",_common.component),(0,_utils.getButtonImage)("icon",_common.component),(0,_loader.getTinyMCE)()]);return tinyMCE.PluginManager.requireLangPack("yuja"),editor=>{editor.ui.registry.addIcon(_common.icon,buttonImage.html),editor.ui.registry.addButton(_common.buttonName,{icon:_common.icon,tooltip:buttonTitle,onAction:()=>handleAction(editor)}),editor.ui.registry.addMenuItem(_common.buttonName,{icon:_common.icon,text:buttonTitle,onAction:()=>handleAction(editor)})}}}));

//# sourceMappingURL=commands.min.js.map