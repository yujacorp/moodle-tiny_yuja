{"version":3,"file":"commands.min.js","sources":["../src/commands.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * YuJa Plugin for Moodle Tiny\r\n * @package    tiny_yuja/commands\r\n * @module     tiny_yuja/commands\r\n * @subpackage yuja\r\n * @copyright  2023 YuJa\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\n\r\n   /**\r\n         * Initializes the plugin, this will be executed after the plugin has been created.\r\n         * This call is done before the editor instance has finished it's initialization so use the onInit event\r\n         * of the editor instance to intercept that event.\r\n         *\r\n         * @param {tiny.Editor} ed Editor instance that the plugin is initialized in.\r\n         * @param {string} url Absolute URL to where the plugin is located.\r\n         */\r\n\r\n\r\n   function loadScript(url) {\r\n    var script = document.createElement('script');\r\n    script.src = url;\r\n    (document.body || document.head || document.documentElement).appendChild(script);\r\n}\r\n\r\n\r\n//showAlertMessage\r\n\r\nfunction showAlertMessage(title, message) {\r\n    // ---------constants and definitions----------\r\n    var $ = $ || jQuery;\r\n    var ID_TOAST_CONTAINER = \"toastMessageContainer\";\r\n    var ID_TOAST_STYLES = \"yujaToastMessageStyles\";\r\n    var CLASS_YUJA_TOASTS = \"yuja-toast-message\";\r\n    var TOAST_MESSAGE_LIFETIME_MS = 3000;\r\n    var TOAST_FADE_OUT_DURATION_MS = 1000;\r\n    // Reuse the class as the ID for simplicity\r\n    var ID_YUJA_TOAST = CLASS_YUJA_TOASTS;\r\n\r\n    /**\r\n     * Preprocess the ID in case suffixes/prefixes need to be added\r\n     * @param {*} id\r\n     * @returns {*}\r\n     */\r\n    function helperIdToCssSelector(id) {\r\n        return \"#\" + (id || \"\");\r\n    }\r\n\r\n    /**\r\n     * JQuery helper to convert\r\n     * @param {*} id\r\n     * @returns {boolean}\r\n     */\r\n    function helperIDExists(id) {\r\n        return $(helperIdToCssSelector(id)).length === 1;\r\n    }\r\n\r\n    /**\r\n     * Create empty toast message container\r\n     */\r\n    function createSingletonToastMessageContainer() {\r\n        if (!helperIDExists(ID_TOAST_CONTAINER)) {\r\n            var $idToastContainer = $(\"<div>\")\r\n                .attr(\"id\", ID_TOAST_CONTAINER);\r\n            $(document.body).append($idToastContainer);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Create toast message styles\r\n     */\r\n    function createSingletonToastMessageStyles() {\r\n        if (!helperIDExists(ID_TOAST_STYLES)) {\r\n            var styles = [];\r\n            styles.push(\"\" +\r\n                \"#toastMessageContainer{\\n\" +\r\n                // Center the toast message container\r\n                \"    position: absolute;\\n\" +\r\n                \"    left: 0;\\n\" +\r\n                \"    right: 0;\\n\" +\r\n                \"    margin: 0 auto;\\n\" +\r\n                // Ensure it is in front of everything\r\n                \"    z-index: 9999;\\n\" +\r\n                // Set the width to match YuJa\r\n                \"    width: 420px;\\n\" +\r\n                // Offset the top bar\r\n                \"    top: 50px;\\n\" +\r\n                \"}\\n\"\r\n            );\r\n            styles.push(\"\" +\r\n                \".yuja-toast-message {\\n\" +\r\n                // Star logo positioning\r\n                \"    background-image: \" +\r\n                \"url(\\\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNC\" +\r\n                \"SVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBl\" +\r\n                \"Lm9yZ5vuPBoAAARkSURBVEiJhZZNbFRVFMd/577XDwTiQg3YvuEjRYMLo6nsWAmRGJB2Os82CExbMVEx\" +\r\n                \"UVGhdWEMLEzAamtiNLoQ6BRYNDMtI9YFiZJA3GHEGKMxpLbMTGvCwg+0rZ1597h4b0o/pniSSW7u+d//\" +\r\n                \"/5zzv7lvhDtEarBunTqmWWAXwgYUDwAhjzImyhdF12YPxCdyy3FIpc3+Qa9eHN4GngOcOxUBWJBMYJyu\" +\r\n                \"Z1vGxv5XYCAdi6voALAKmAUdRsx5KQXf6UyQB5Bax8M4jdYQF9U4UA3cEmR/0s99vqzAQNp7VYVewAik\" +\r\n                \"DaZ7n39j9E7lnx6ONThWexRaAKtwqMPPf7hEIKo8A6iqdHU8netd0t2Q1w2QTORPLM71p70jIhwPSaWl\" +\r\n                \"3IkAnMnUexb5KRyLHG73c+8vJa9/RFWuAYjoo8lE4fvFmFTG6wJOALeqXNn8THNuwgBYkWPAKoF0JfIw\" +\r\n                \"zGvllSqHKiHa/fy7wHlgdbGoRwEkNVi3DseMAoGDeajSzAcy6+9Xgl8BN9oqCc7GpD8+uQQ76G1Shx8B\" +\r\n                \"x6Ab3OieO6Dpff6N0VODG9Y6bmm36G1/lNLjIDVAJtrylVLvQMa7NIcRNCi5F5JtY9dTmVgWtNWKaXYF\" +\r\n                \"dgKImiyA6wbHVenQBXWFWhbbB2AwPsgehT1zEAXXDfqBThHNqtKK6k4X2BQe0qsAgXLSQCtwF/APyjkE\" +\r\n                \"RfTnzsTENwCpofrXUdms4XXeG2GnAuVkOEB7FceA0GCAtQBV9t9JgE4/d1msPAn8DazE4Iz+kD/Ynij0\" +\r\n                \"zZmZKPQlE/kXBS2WyY3Vpk4/dxmghmIh6qreLDYJINmau4JoMzCFcqDh4djHS8wc8j4BOQhMKfrU/tbC\" +\r\n                \"V+Xc7OzdJhKwBpgAmHar6+YTtCcKXxurTSFOX+gfqr+nnDt3oe5e4HkAY7Wpwy9cmn+2WDtVF1k34QKj\" +\r\n                \"wIPGmseAX+YD1ejvocE6tqJU+GNgKHYYwJ3O9ZUcbxxYH2IWhsFsiZajRpQRAGuILwaqmh3hSq7NON5F\" +\r\n                \"Ve1R1Z4Zx7uIci1MmSeWCAjNYecyYoquzQKBqMZPD8caFiCF8uFmYBvwW/TbhhCOT9kx/8jZtPeAhvgS\" +\r\n                \"gWbNgfhETuEUUO1Y7SkDU6k1K4Gtc1LCFcFpFJxGhCvcfii3RlhUkQB6gCpBPutoyxdCtwOOArcUWvrT\" +\r\n                \"3hEAVlVtAWrCWUnf9M0125P++GTSH5+cvrlmOyrla1sTYRnIeN2E4/kTzDGY/1xnYk2KDkeVvOnM1H5q\" +\r\n                \"V8z0InzZnsgPLZ4zQGrIS6DsrA2q35gxswcR3glJtSnpF0YWCAD0Z7yXBT4IfWKYgK5kW/56JfL5My+J\" +\r\n                \"vidIE2AReaU9kfuonF/yyUyl63Yj5iywGiiCnBfRbMnab1faYh5gxnVjgtOIEo8MrUL5S0T3litfVgDg\" +\r\n                \"5ODa+1zjvoXwEref6OXCAmcFp7vS811RoBxnMvWeFdMsVnepsBGivy2QB0YVGSHQbEdbvrAcx3+/BcsB\" +\r\n                \"IawLQwAAAABJRU5ErkJggg==\\\") !important;\\n\" +\r\n                \"    background-repeat: no-repeat;\\n\" +\r\n                \"    background-position: 15px center;\\n\" +\r\n                \"    background-color: white;\\n\" +\r\n                \"    padding: 15px;\\n\" +\r\n                // Round borders\r\n                \"    -moz-border-radius: 3px 3px 3px 3px;\\n\" +\r\n                \"    -webkit-border-radius: 3px 3px 3px 3px;\\n\" +\r\n                \"    border-radius: 3px 3px 3px 3px;\\n\" +\r\n                // Add a drop/background hsadow\r\n                \"    -moz-box-shadow: 0 0 12px #999999;\\n\" +\r\n                \"    -webkit-box-shadow: 0 0 12px #999999;\\n\" +\r\n                \"    box-shadow: 0 0 12px #999999;\\n\" +\r\n                \"    opacity: 0.95;\\n\" +\r\n                \"    -ms-filter: progid:DXImageTransform.Microsoft.Alpha(Opacity=80);\\n\" +\r\n                \"    filter: alpha(opacity=80);\\n\" +\r\n                // Ensure the progress bars align to this reference point\r\n                \"    position: relative;\\n\" +\r\n                // Indicate it is killable with a click\r\n                \"    cursor: pointer;\\n\" +\r\n                \"}\");\r\n            styles.push(\"\" +\r\n                \".message-container {\\n\" +\r\n                // Offset the star above\r\n                \"    padding-left: 25px;\\n\" +\r\n                \"}\"\r\n            );\r\n            styles.push(\"\" +\r\n                \".message-content {\\n\" +\r\n                // Space for the side bar\r\n                \"    padding-left: 15px;\\n\" +\r\n                \"}\"\r\n            );\r\n            styles.push(\"\" +\r\n                \".header {\\n\" +\r\n                \"    font-weight: bold;\\n\" +\r\n                \"    font-size: 15px;\\n\" +\r\n                \"    color: #A2AD1C;\\n\" +\r\n                \"}\\n\"\r\n            );\r\n            styles.push(\"\" +\r\n                \".left-side-border{\\n\" +\r\n                // Add the vertical rainbow bar\r\n                \"    content: url(\\\"data:image/png;base64,\" +\r\n                \"/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAAAAD/4QMxaHR0cDovL25zLmFkb2Jl\" +\r\n                \"LmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/\" +\r\n                \"PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYt\" +\r\n                \"YzEzOCA3OS4xNTk4MjQsIDIwMTYvMDkvMTQtMDE6MDk6MDEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0i\" +\r\n                \"aHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRm\" +\r\n                \"OmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6eG1wTU09Imh0\" +\r\n                \"dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hh\" +\r\n                \"cC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE3\" +\r\n                \"IChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjU1MTM3NzE3QkE4MzExRTc5RDFBQ0QzQTA5\" +\r\n                \"NDIwQkI2IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjU1MTM3NzE4QkE4MzExRTc5RDFBQ0QzQTA5NDIwQkI2\" +\r\n                \"Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NTUxMzc3MTVCQTgzMTFFNzlE\" +\r\n                \"MUFDRDNBMDk0MjBCQjYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NTUxMzc3MTZCQTgzMTFFNzlEMUFDRDNB\" +\r\n                \"MDk0MjBCQjYiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBl\" +\r\n                \"bmQ9InIiPz7/7gAOQWRvYmUAZMAAAAAB/9sAhAAbGhopHSlBJiZBQi8vL0JHPz4+P0dHR0dHR0dHR0dHR0dHR0dH\" +\r\n                \"R0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHAR0pKTQmND8oKD9HPzU/R0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dH\" +\r\n                \"R0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0f/wAARCABKAAUDASIAAhEBAxEB/8QAZwABAAMBAAAAAAAAAAAAAAAA\" +\r\n                \"AAMEBQIBAQEBAQAAAAAAAAAAAAAAAAQCAwUQAQACAQUBAAAAAAAAAAAAAAABYRORoQISUhQRAAECBQUBAAAAAAAA\" +\r\n                \"AAAAAAABEyFhAhJS8JGh4SIU/9oADAMBAAIRAxEAPwDUGbk4+o1gR8qZcdhXqsdbGZ0kXfl50F3Dm0ma+KaEmSBy\" +\r\n                \"Hq5GsSlnrcUM1CmxNqEHao3HIZAn1M//2Q==\\\");\\n\" +\r\n                \"    width: 5px;\\n\" +\r\n                // Ensure it is the size of the parent\r\n                \"    height: 100%;\\n\" +\r\n                // Left align it\r\n                \"    position: absolute;\\n\" +\r\n                \"    top: 0;\\n\" +\r\n                \"    left: 0;\" +\r\n                \"}\\n\"\r\n            );\r\n            styles.push(\"\" +\r\n                \".toast-lifetime-progress {\\n\" +\r\n                \"    position: absolute;\\n\" +\r\n                \"    top: 0;\\n\" +\r\n                \"    left: 0;\\n\" +\r\n                \"    width: 0;\\n\" +\r\n                \"    transition: width 3s, background-color 3s;\\n\" +\r\n                \"    height: 5px;\\n\" +\r\n                \"    background-color: #73ff04;\\n\" +\r\n                \"}\"\r\n            );\r\n            styles.push(\"\" +\r\n                \".toast-lifetime-progress.start-animation {\\n\" +\r\n                \"    background-color: #ff0005;\\n\" +\r\n                \"    width: 100%;\\n\" +\r\n                \"}\"\r\n            );\r\n            var $toastMesageStyles = $(\"<style>\")\r\n                .attr(\"id\", ID_TOAST_STYLES)\r\n                // Add the styles as an array, making it inline text and thus apply to the browser\r\n                .append(styles);\r\n            $(document.head).append($toastMesageStyles);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Toast messages are stackable and each needs to be unique.\r\n     * The uniqueness can be guaranteed with the jquery instance of classes count + 1\r\n     * @returns {*}\r\n     */\r\n    function getNextAvailableToastMessageUniqueID() {\r\n        var nextUniqueId = $(\".\" + CLASS_YUJA_TOASTS).length + 1;\r\n        return ID_YUJA_TOAST + \"-\" + nextUniqueId;\r\n    }\r\n\r\n    /**\r\n     * Helper to Construct Message\r\n     * @returns {*}\r\n     */\r\n    function helperConstructMessage() {\r\n        var $leftSideBar = $(\"<div>\")\r\n            .attr(\"class\", \"left-side-border\");\r\n        var $progressBar = $(\"<div>\")\r\n            .attr(\"class\", \"toast-lifetime-progress\");\r\n        var $header = $(\"<div>\")\r\n            .attr(\"class\", \"message-content header\")\r\n            .append(title);\r\n        var $body = $(\"<div>\")\r\n            .attr(\"class\", \"message-content body\")\r\n            .append(message);\r\n\r\n        return $(\"<div>\")\r\n            .attr(\"class\", \"message-container\")\r\n            .append($progressBar)\r\n            .append($leftSideBar)\r\n            .append($header)\r\n            .append($body);\r\n    }\r\n\r\n    /**\r\n     * Hide toast message\r\n     * @param {*} $toast\r\n     * @returns {*}\r\n     */\r\n    function killToastMessage($toast) {\r\n        return function() {\r\n            if ($toast.length === 1) {\r\n                // Only hide the toast messages since the other ones may reuse the ID and that\r\n                // will cause old-style reuse (id 1 -> gets deleted -> new toast takes id->1 progress)\r\n                $toast\r\n                    .css({display: \"none\"});\r\n            }\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Fade out toast message before hiding it\r\n     * @param {*} newToastId\r\n     * @returns {*}\r\n     */\r\n    function fadeAndKillToastMessage(newToastId) {\r\n        return function() {\r\n            var $toast = $(helperIdToCssSelector(newToastId));\r\n            if ($toast.length === 1) {\r\n                // Fade out the toast\r\n                $toast\r\n                    .css({\r\n                        \"transition\": \"opacity \" + TOAST_FADE_OUT_DURATION_MS + \"ms\",\r\n                        opacity: \"0\"\r\n                    });\r\n                // Delete it\r\n                setTimeout(killToastMessage($toast), TOAST_FADE_OUT_DURATION_MS);\r\n            }\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Create toast message\r\n     */\r\n    function createToastMessage() {\r\n        createSingletonToastMessageContainer();\r\n        createSingletonToastMessageStyles();\r\n        var newToastId = getNextAvailableToastMessageUniqueID();\r\n        var $toastContainer = $(helperIdToCssSelector(ID_TOAST_CONTAINER));\r\n        if ($toastContainer.length === 1) {\r\n            $toastContainer\r\n                .append(\r\n                    $(\"<div>\")\r\n                        .attr(\"id\", newToastId)\r\n                        // Toast class adds the progress bar above the message\r\n                        .attr(\"class\", CLASS_YUJA_TOASTS)\r\n                        .on(\"click\", function() {\r\n                            killToastMessage($(helperIdToCssSelector(newToastId)));\r\n                        })\r\n                        .append(helperConstructMessage())\r\n                );\r\n            // Start the animations on  delay\r\n            setTimeout(function() {\r\n                if ($toastContainer.length === 1) {\r\n                    $toastContainer\r\n                        .find(helperIdToCssSelector(newToastId))\r\n                        .find(\".toast-lifetime-progress\")\r\n                        .addClass(\"start-animation\");\r\n                }\r\n            }, 25);\r\n            // Kill the toast message in X seconds\r\n            setTimeout(fadeAndKillToastMessage(newToastId), TOAST_MESSAGE_LIFETIME_MS);\r\n        }\r\n    }\r\n    // ---------end constants and definitions----------\r\n    createToastMessage();\r\n}\r\n\r\n   const handleAction = (editor) => {\r\n        /**\r\n         * Initializes the plugin, this will be executed after the plugin has been created.\r\n         * This call is done before the editor instance has finished it's initialization so use the onInit event\r\n         * of the editor instance to intercept that event.\r\n         *\r\n         * @param {tiny.Editor} ed Editor instance that the plugin is initialized in.\r\n         * @param {string} url Absolute URL to where the plugin is located.\r\n         */\r\n    \r\n        var mediaSelector = null;\r\n        var params = {\r\n            videosUrl: editor.getParam('yujaVideosUrl', undefined),\r\n            jsUrl: editor.getParam('yujaJsUrl',undefined),\r\n            error: editor.getParam('yujaError', undefined)\r\n        };\r\n\r\n        //params = params + cfg.get_texteditor_params();\r\n        /**\r\n         * This request written without JQuery for backwards compatability with Moodle < 2.9\r\n         */\r\n        var xmlhttp;\r\n\r\n        if (window.XMLHttpRequest) {\r\n            xmlhttp = new XMLHttpRequest(); // Code for IE7+, Firefox, Chrome, Opera, Safari\r\n        } else {\r\n            xmlhttp = new ActiveXObject(\"Microsoft.XMLHTTP\"); // Code for IE6, IE5\r\n        }\r\n\r\n        // Delay the connection to YuJa until the button is clicked\r\n        var isYujaConnected = false;\r\n        // If the button is clicked, execute a callback that is just the mce command\r\n        var yujaConnectedCallback = null;\r\n        xmlhttp.onreadystatechange = function() {\r\n            if (xmlhttp.readyState == XMLHttpRequest.DONE) {\r\n                if (xmlhttp.status == 200) {\r\n                    try {\r\n                        params.videos = JSON.parse(xmlhttp.responseText);\r\n                    } catch (err) {\r\n                        params.videos = {success: false};\r\n                    }\r\n                } else {\r\n                    params.videos = {success: false};\r\n                }\r\n                if (typeof yujaConnectedCallback === \"function\") {\r\n                    // Call the mceYuja function\r\n                    yujaConnectedCallback();\r\n                    yujaConnectedCallback = null;\r\n                }\r\n            }\r\n        };\r\n\r\n       \r\n            var error = false;\r\n            if (!isYujaConnected) {\r\n                isYujaConnected = true;\r\n                // Mount the script that will load the common yuja variables\r\n                loadScript(params.jsUrl);\r\n                // Load the videos\r\n                xmlhttp.open(\"GET\", params.videosUrl, true);\r\n                xmlhttp.send();\r\n                error = true;\r\n                // Call this function again once complete\r\n                yujaConnectedCallback = this.execCommands['mceYuja'].func.bind(this, this, false);\r\n\r\n            } else if (params.error !== undefined) {\r\n                showAlertMessage(\"Error\", ed.getLang('yuja.phperror'));\r\n                error = true;\r\n            } else if (params.videos !== undefined && params.videos.success === false) {\r\n                showAlertMessage(\"Loading...\", ed.getLang('yuja.loadingerror'));\r\n                error = true;\r\n            } else if (params.videos === undefined || (typeof yuja === \"undefined\" || yuja === undefined)) {\r\n                showAlertMessage(\"Loading...\", ed.getLang('yuja.notready'));\r\n                error = true;\r\n            }\r\n\r\n            if (error) {\r\n                return;\r\n            }\r\n\r\n            if (mediaSelector === null) {\r\n                mediaSelector = yuja.createMediaSelector(params.videos.data);\r\n            }\r\n\r\n            mediaSelector.onSelect(function(embedString) {\r\n                ed.execCommand('mceInsertContent', false, embedString);\r\n            });\r\n\r\n            mediaSelector.open();\r\n\r\n   };\r\n\r\n/**\r\n * Get the setup function for the buttons.\r\n *\r\n * This is performed in an async function which ultimately returns the registration function as the\r\n * Tiny.AddOnManager.Add() function does not support async functions.\r\n *\r\n * @returns {function} The registration function to call within the Plugin.add function.\r\n */\r\nimport {getButtonImage} from 'editor_tiny/utils';\r\nimport {getTinyMCE} from 'editor_tiny/loader';\r\nimport {\r\n    component,\r\n    buttonName,\r\n    icon,\r\n} from './common';\r\n\r\nexport const getSetup = async() => {\r\n    const [\r\n        buttonImage,\r\n        tinyMCE,\r\n    ] = await Promise.all([\r\n        getButtonImage('icon', component),\r\n        getTinyMCE(),\r\n    ]);\r\n    //load yuja pack\r\n    tinyMCE.PluginManager.requireLangPack('yuja');\r\n   \r\n\r\n    return (editor) => {\r\n        // Register the Moodle SVG as an icon suitable for use as a tiny toolbar button.\r\n        editor.ui.registry.addIcon(icon, buttonImage.html);\r\n\r\n        // Register the yujaMedia Button.\r\n        editor.ui.registry.addButton(buttonName, {\r\n            icon,\r\n            onAction: () => handleAction(editor),\r\n        });\r\n\r\n       // Add the yujaMedia Menu Item.\r\n      // This allows it to be added to a standard menu, or a context menu.\r\n      editor.ui.registry.addMenuItem(buttonName, {\r\n           icon,\r\n           onAction: () => handleAction(editor),\r\n        });\r\n    };\r\n};\r\n\r\n"],"names":["loadScript","url","script","document","createElement","src","body","head","documentElement","appendChild","showAlertMessage","title","message","$","jQuery","ID_TOAST_CONTAINER","ID_TOAST_STYLES","CLASS_YUJA_TOASTS","TOAST_MESSAGE_LIFETIME_MS","TOAST_FADE_OUT_DURATION_MS","ID_YUJA_TOAST","helperIdToCssSelector","id","helperIDExists","length","createSingletonToastMessageContainer","$idToastContainer","attr","append","createSingletonToastMessageStyles","styles","push","$toastMesageStyles","getNextAvailableToastMessageUniqueID","nextUniqueId","helperConstructMessage","$leftSideBar","$progressBar","$header","$body","killToastMessage","$toast","css","display","fadeAndKillToastMessage","newToastId","transition","opacity","setTimeout","createToastMessage","$toastContainer","on","find","addClass","handleAction","mediaSelector","params","videosUrl","editor","getParam","undefined","jsUrl","error","getFpoptions","xmlhttp","window","XMLHttpRequest","ActiveXObject","isYujaConnected","yujaConnectedCallback","onreadystatechange","readyState","DONE","status","videos","JSON","parse","responseText","err","success","open","send","this","execCommands","func","bind","ed","getLang","yuja","createMediaSelector","data","onSelect","embedString","execCommand","getButtonImage","getTinyMCE","component","buttonName","icon","getSetup","async","buttonImage","tinyMCE","await","Promise","all","PluginManager","requireLangPack","ui","registry","addIcon","html","addButton","onAction","addMenuItem"],"mappings":"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"}