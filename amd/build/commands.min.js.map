{"version":3,"file":"commands.min.js","sources":["../src/commands.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * YuJa Plugin for Moodle Tiny\n * @module     tiny_yuja/commands\n * @copyright  2023 YuJa\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {getParamUrls} from './options';\n\nvar handlerLoaded = false;\n\nfunction loadScript(url) {\n    var script = document.createElement('script');\n    script.src = url;\n    (document.body || document.head || document.documentElement).appendChild(script);\n}\n\nfunction embedHandler(editor, embedString) {\n    var editorcontents = editor.getContent();\n    var arrayofIframe = editorcontents.split(\"<iframe\");\n    var splitembedString = embedString.split(\" \");\n    var currentURL = embedString.match(/https?:\\/\\/[^\\s]+/)[0];\n    const urlParams = new URLSearchParams(currentURL);\n    const auth = urlParams.get('a');\n    var error = false;\n    //to avoid duplicate video with same height and width\n    arrayofIframe.forEach(function(item,index){\n        if(item.includes(splitembedString[1].match(/\\d/g).join(\"\")) && item.includes(splitembedString[2].match(/\\d/g).join(\"\")) && item.includes(auth)){\n         error = true;;\n        }\n        \n        });\n    if(!error){\n        editor.execCommand('mceInsertContent', false, embedString);\n    }\n}\n\nfunction loadIframe(url, editor) {\n    var script = document.createElement('script');\n    script.onload = function () {\n        require(['jquery'], function($) {\n            $(\"#yujaVideoChooserIFrame\").attr('src',url);\n            \n            if (!handlerLoaded) {\n                if (window.addEventListener) {  // all browsers except IE before version 9\n                    window.addEventListener (\"message\", OnMessage, false);\n                } else {\n                    if (window.attachEvent) {   // IE before version 9\n                        window.attachEvent(\"onmessage\", OnMessage);\n                    }\n                }\n                \n                function OnMessage(event) {\n                    if(event.data.type == \"getVideo\") {\n        \n                        var embedString = event.data.embed;\n                        embedHandler(editor, embedString);\n                        \n                        require(['jquery'], function($) {\n                            $(\".yuja-overlay\").removeClass('yuja-overlay-visible');\n                            $(\"#yujaVideoChooserIFrame\").attr('src',\"\");\n                        });\n                    }\n                }\n\n                handlerLoaded = true;\n            }\n        });\n    };\n    script.src = location.origin + \"/local/yuja/media_selection.js\";\n    (document.body || document.head || document.documentElement).appendChild(script);\n}\n\nfunction showAlertMessage(title, message) {\n    // ---------constants and definitions----------\n    var $ = $ || jQuery;\n    var ID_TOAST_CONTAINER = \"toastMessageContainer\";\n    var ID_TOAST_STYLES = \"yujaToastMessageStyles\";\n    var CLASS_YUJA_TOASTS = \"yuja-toast-message\";\n    var TOAST_MESSAGE_LIFETIME_MS = 3000;\n    var TOAST_FADE_OUT_DURATION_MS = 1000;\n    // Reuse the class as the ID for simplicity\n    var ID_YUJA_TOAST = CLASS_YUJA_TOASTS;\n\n    /**\n     * Preprocess the ID in case suffixes/prefixes need to be added\n     * @param {*} id\n     * @returns {*}\n     */\n    function helperIdToCssSelector(id) {\n        return \"#\" + (id || \"\");\n    }\n\n    /**\n     * JQuery helper to convert\n     * @param {*} id\n     * @returns {boolean}\n     */\n    function helperIDExists(id) {\n        return $(helperIdToCssSelector(id)).length === 1;\n    }\n\n    /**\n     * Create empty toast message container\n     */\n    function createSingletonToastMessageContainer() {\n        if (!helperIDExists(ID_TOAST_CONTAINER)) {\n            var $idToastContainer = $(\"<div>\")\n                .attr(\"id\", ID_TOAST_CONTAINER);\n            $(document.body).append($idToastContainer);\n        }\n    }\n\n    /**\n     * Create toast message styles\n     */\n    function createSingletonToastMessageStyles() {\n        if (!helperIDExists(ID_TOAST_STYLES)) {\n            var styles = [];\n            styles.push(\"\" +\n                \"#toastMessageContainer{\\n\" +\n                // Center the toast message container\n                \"    position: absolute;\\n\" +\n                \"    left: 0;\\n\" +\n                \"    right: 0;\\n\" +\n                \"    margin: 0 auto;\\n\" +\n                // Ensure it is in front of everything\n                \"    z-index: 9999;\\n\" +\n                // Set the width to match YuJa\n                \"    width: 420px;\\n\" +\n                // Offset the top bar\n                \"    top: 50px;\\n\" +\n                \"}\\n\"\n            );\n            styles.push(\"\" +\n                \".yuja-toast-message {\\n\" +\n                // Star logo positioning\n                \"    background-image: \" +\n                \"url(\\\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNC\" +\n                \"SVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBl\" +\n                \"Lm9yZ5vuPBoAAARkSURBVEiJhZZNbFRVFMd/577XDwTiQg3YvuEjRYMLo6nsWAmRGJB2Os82CExbMVEx\" +\n                \"UVGhdWEMLEzAamtiNLoQ6BRYNDMtI9YFiZJA3GHEGKMxpLbMTGvCwg+0rZ1597h4b0o/pniSSW7u+d//\" +\n                \"/5zzv7lvhDtEarBunTqmWWAXwgYUDwAhjzImyhdF12YPxCdyy3FIpc3+Qa9eHN4GngOcOxUBWJBMYJyu\" +\n                \"Z1vGxv5XYCAdi6voALAKmAUdRsx5KQXf6UyQB5Bax8M4jdYQF9U4UA3cEmR/0s99vqzAQNp7VYVewAik\" +\n                \"DaZ7n39j9E7lnx6ONThWexRaAKtwqMPPf7hEIKo8A6iqdHU8netd0t2Q1w2QTORPLM71p70jIhwPSaWl\" +\n                \"3IkAnMnUexb5KRyLHG73c+8vJa9/RFWuAYjoo8lE4fvFmFTG6wJOALeqXNn8THNuwgBYkWPAKoF0JfIw\" +\n                \"zGvllSqHKiHa/fy7wHlgdbGoRwEkNVi3DseMAoGDeajSzAcy6+9Xgl8BN9oqCc7GpD8+uQQ76G1Shx8B\" +\n                \"x6Ab3OieO6Dpff6N0VODG9Y6bmm36G1/lNLjIDVAJtrylVLvQMa7NIcRNCi5F5JtY9dTmVgWtNWKaXYF\" +\n                \"dgKImiyA6wbHVenQBXWFWhbbB2AwPsgehT1zEAXXDfqBThHNqtKK6k4X2BQe0qsAgXLSQCtwF/APyjkE\" +\n                \"RfTnzsTENwCpofrXUdms4XXeG2GnAuVkOEB7FceA0GCAtQBV9t9JgE4/d1msPAn8DazE4Iz+kD/Ynij0\" +\n                \"zZmZKPQlE/kXBS2WyY3Vpk4/dxmghmIh6qreLDYJINmau4JoMzCFcqDh4djHS8wc8j4BOQhMKfrU/tbC\" +\n                \"V+Xc7OzdJhKwBpgAmHar6+YTtCcKXxurTSFOX+gfqr+nnDt3oe5e4HkAY7Wpwy9cmn+2WDtVF1k34QKj\" +\n                \"wIPGmseAX+YD1ejvocE6tqJU+GNgKHYYwJ3O9ZUcbxxYH2IWhsFsiZajRpQRAGuILwaqmh3hSq7NON5F\" +\n                \"Ve1R1Z4Zx7uIci1MmSeWCAjNYecyYoquzQKBqMZPD8caFiCF8uFmYBvwW/TbhhCOT9kx/8jZtPeAhvgS\" +\n                \"gWbNgfhETuEUUO1Y7SkDU6k1K4Gtc1LCFcFpFJxGhCvcfii3RlhUkQB6gCpBPutoyxdCtwOOArcUWvrT\" +\n                \"3hEAVlVtAWrCWUnf9M0125P++GTSH5+cvrlmOyrla1sTYRnIeN2E4/kTzDGY/1xnYk2KDkeVvOnM1H5q\" +\n                \"V8z0InzZnsgPLZ4zQGrIS6DsrA2q35gxswcR3glJtSnpF0YWCAD0Z7yXBT4IfWKYgK5kW/56JfL5My+J\" +\n                \"vidIE2AReaU9kfuonF/yyUyl63Yj5iywGiiCnBfRbMnab1faYh5gxnVjgtOIEo8MrUL5S0T3litfVgDg\" +\n                \"5ODa+1zjvoXwEref6OXCAmcFp7vS811RoBxnMvWeFdMsVnepsBGivy2QB0YVGSHQbEdbvrAcx3+/BcsB\" +\n                \"IawLQwAAAABJRU5ErkJggg==\\\") !important;\\n\" +\n                \"    background-repeat: no-repeat;\\n\" +\n                \"    background-position: 15px center;\\n\" +\n                \"    background-color: white;\\n\" +\n                \"    padding: 15px;\\n\" +\n                // Round borders\n                \"    -moz-border-radius: 3px 3px 3px 3px;\\n\" +\n                \"    -webkit-border-radius: 3px 3px 3px 3px;\\n\" +\n                \"    border-radius: 3px 3px 3px 3px;\\n\" +\n                // Add a drop/background hsadow\n                \"    -moz-box-shadow: 0 0 12px #999999;\\n\" +\n                \"    -webkit-box-shadow: 0 0 12px #999999;\\n\" +\n                \"    box-shadow: 0 0 12px #999999;\\n\" +\n                \"    opacity: 0.95;\\n\" +\n                \"    -ms-filter: progid:DXImageTransform.Microsoft.Alpha(Opacity=80);\\n\" +\n                \"    filter: alpha(opacity=80);\\n\" +\n                // Ensure the progress bars align to this reference point\n                \"    position: relative;\\n\" +\n                // Indicate it is killable with a click\n                \"    cursor: pointer;\\n\" +\n                \"}\");\n            styles.push(\"\" +\n                \".message-container {\\n\" +\n                // Offset the star above\n                \"    padding-left: 25px;\\n\" +\n                \"}\"\n            );\n            styles.push(\"\" +\n                \".message-content {\\n\" +\n                // Space for the side bar\n                \"    padding-left: 15px;\\n\" +\n                \"}\"\n            );\n            styles.push(\"\" +\n                \".header {\\n\" +\n                \"    font-weight: bold;\\n\" +\n                \"    font-size: 15px;\\n\" +\n                \"    color: #A2AD1C;\\n\" +\n                \"}\\n\"\n            );\n            styles.push(\"\" +\n                \".left-side-border{\\n\" +\n                // Add the vertical rainbow bar\n                \"    content: url(\\\"data:image/png;base64,\" +\n                \"/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAAAAD/4QMxaHR0cDovL25zLmFkb2Jl\" +\n                \"LmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/\" +\n                \"PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYt\" +\n                \"YzEzOCA3OS4xNTk4MjQsIDIwMTYvMDkvMTQtMDE6MDk6MDEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0i\" +\n                \"aHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRm\" +\n                \"OmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6eG1wTU09Imh0\" +\n                \"dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hh\" +\n                \"cC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE3\" +\n                \"IChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjU1MTM3NzE3QkE4MzExRTc5RDFBQ0QzQTA5\" +\n                \"NDIwQkI2IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjU1MTM3NzE4QkE4MzExRTc5RDFBQ0QzQTA5NDIwQkI2\" +\n                \"Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NTUxMzc3MTVCQTgzMTFFNzlE\" +\n                \"MUFDRDNBMDk0MjBCQjYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NTUxMzc3MTZCQTgzMTFFNzlEMUFDRDNB\" +\n                \"MDk0MjBCQjYiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBl\" +\n                \"bmQ9InIiPz7/7gAOQWRvYmUAZMAAAAAB/9sAhAAbGhopHSlBJiZBQi8vL0JHPz4+P0dHR0dHR0dHR0dHR0dHR0dH\" +\n                \"R0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHAR0pKTQmND8oKD9HPzU/R0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dH\" +\n                \"R0dHR0dHR0dHR0dHR0dHR0dHR0dHR0dHR0f/wAARCABKAAUDASIAAhEBAxEB/8QAZwABAAMBAAAAAAAAAAAAAAAA\" +\n                \"AAMEBQIBAQEBAQAAAAAAAAAAAAAAAAQCAwUQAQACAQUBAAAAAAAAAAAAAAABYRORoQISUhQRAAECBQUBAAAAAAAA\" +\n                \"AAAAAAABEyFhAhJS8JGh4SIU/9oADAMBAAIRAxEAPwDUGbk4+o1gR8qZcdhXqsdbGZ0kXfl50F3Dm0ma+KaEmSBy\" +\n                \"Hq5GsSlnrcUM1CmxNqEHao3HIZAn1M//2Q==\\\");\\n\" +\n                \"    width: 5px;\\n\" +\n                // Ensure it is the size of the parent\n                \"    height: 100%;\\n\" +\n                // Left align it\n                \"    position: absolute;\\n\" +\n                \"    top: 0;\\n\" +\n                \"    left: 0;\" +\n                \"}\\n\"\n            );\n            styles.push(\"\" +\n                \".toast-lifetime-progress {\\n\" +\n                \"    position: absolute;\\n\" +\n                \"    top: 0;\\n\" +\n                \"    left: 0;\\n\" +\n                \"    width: 0;\\n\" +\n                \"    transition: width 3s, background-color 3s;\\n\" +\n                \"    height: 5px;\\n\" +\n                \"    background-color: #73ff04;\\n\" +\n                \"}\"\n            );\n            styles.push(\"\" +\n                \".toast-lifetime-progress.start-animation {\\n\" +\n                \"    background-color: #ff0005;\\n\" +\n                \"    width: 100%;\\n\" +\n                \"}\"\n            );\n            var $toastMesageStyles = $(\"<style>\")\n                .attr(\"id\", ID_TOAST_STYLES)\n                // Add the styles as an array, making it inline text and thus apply to the browser\n                .append(styles);\n            $(document.head).append($toastMesageStyles);\n        }\n    }\n\n    /**\n     * Toast messages are stackable and each needs to be unique.\n     * The uniqueness can be guaranteed with the jquery instance of classes count + 1\n     * @returns {*}\n     */\n    function getNextAvailableToastMessageUniqueID() {\n        var nextUniqueId = $(\".\" + CLASS_YUJA_TOASTS).length + 1;\n        return ID_YUJA_TOAST + \"-\" + nextUniqueId;\n    }\n\n    /**\n     * Helper to Construct Message\n     * @returns {*}\n     */\n    function helperConstructMessage() {\n        var $leftSideBar = $(\"<div>\")\n            .attr(\"class\", \"left-side-border\");\n        var $progressBar = $(\"<div>\")\n            .attr(\"class\", \"toast-lifetime-progress\");\n        var $header = $(\"<div>\")\n            .attr(\"class\", \"message-content header\")\n            .append(title);\n        var $body = $(\"<div>\")\n            .attr(\"class\", \"message-content body\")\n            .append(message);\n\n        return $(\"<div>\")\n            .attr(\"class\", \"message-container\")\n            .append($progressBar)\n            .append($leftSideBar)\n            .append($header)\n            .append($body);\n    }\n\n    /**\n     * Hide toast message\n     * @param {*} $toast\n     * @returns {*}\n     */\n    function killToastMessage($toast) {\n        return function () {\n            if ($toast.length === 1) {\n                // Only hide the toast messages since the other ones may reuse the ID and that\n                // will cause old-style reuse (id 1 -> gets deleted -> new toast takes id->1 progress)\n                $toast\n                    .css({ display: \"none\" });\n            }\n        };\n    }\n\n    /**\n     * Fade out toast message before hiding it\n     * @param {*} newToastId\n     * @returns {*}\n     */\n    function fadeAndKillToastMessage(newToastId) {\n        return function () {\n            var $toast = $(helperIdToCssSelector(newToastId));\n            if ($toast.length === 1) {\n                // Fade out the toast\n                $toast\n                    .css({\n                        \"transition\": \"opacity \" + TOAST_FADE_OUT_DURATION_MS + \"ms\",\n                        opacity: \"0\"\n                    });\n                // Delete it\n                setTimeout(killToastMessage($toast), TOAST_FADE_OUT_DURATION_MS);\n            }\n        };\n    }\n\n    /**\n     * Create toast message\n     */\n    function createToastMessage() {\n        createSingletonToastMessageContainer();\n        createSingletonToastMessageStyles();\n        var newToastId = getNextAvailableToastMessageUniqueID();\n        var $toastContainer = $(helperIdToCssSelector(ID_TOAST_CONTAINER));\n        if ($toastContainer.length === 1) {\n            $toastContainer\n                .append(\n                    $(\"<div>\")\n                        .attr(\"id\", newToastId)\n                        // Toast class adds the progress bar above the message\n                        .attr(\"class\", CLASS_YUJA_TOASTS)\n                        .on(\"click\", function () {\n                            killToastMessage($(helperIdToCssSelector(newToastId)));\n                        })\n                        .append(helperConstructMessage())\n                );\n            // Start the animations on  delay\n            setTimeout(function () {\n                if ($toastContainer.length === 1) {\n                    $toastContainer\n                        .find(helperIdToCssSelector(newToastId))\n                        .find(\".toast-lifetime-progress\")\n                        .addClass(\"start-animation\");\n                }\n            }, 25);\n            // Kill the toast message in X seconds\n            setTimeout(fadeAndKillToastMessage(newToastId), TOAST_MESSAGE_LIFETIME_MS);\n        }\n    }\n    // ---------end constants and definitions----------\n    createToastMessage();\n}\n\nconst handleAction = (editor) => {\n    /**\n     * Initializes the plugin, this will be executed after the plugin has been created.\n     * This call is done before the editor instance has finished it's initialization so use the onInit event\n     * of the editor instance to intercept that event.\n     *\n     * @param {tiny.Editor} editor Editor instance that the plugin is initialized in.\n     * @param {string} url Absolute URL to where the plugin is located.\n     */\n    var mediaSelector = null;\n    var params = getParamUrls(editor);\n\n    if (params.ltiVersion == \"1.3\") {\n        loadIframe(params.lti3LoginInitUrl, editor);\n        return;\n    }\n\n    if (params.yujaError !== undefined && params.yujaError !== null) {\n        showAlertMessage(\"Error\", 'The YuJa media chooser experienced an error.  Please ensure your configuration information is correct and try refreshing the page. If the error persists, please contact YuJa support.');\n        return;\n    }\n\n    /**\n     * This request written without JQuery for backwards compatability with Moodle < 2.9\n     */\n    var xmlhttp;\n\n    if (window.XMLHttpRequest) {\n        xmlhttp = new XMLHttpRequest(); // Code for IE7+, Firefox, Chrome, Opera, Safari\n    } else {\n        xmlhttp = new ActiveXObject(\"Microsoft.XMLHTTP\"); // Code for IE6, IE5\n    }\n\n    // Delay the connection to YuJa until the button is clicked\n    // If the button is clicked, execute a callback that is just the mce command\n    var yujaConnectedCallback = null;\n    xmlhttp.onreadystatechange = function () {\n        if (xmlhttp.readyState == XMLHttpRequest.DONE) {\n            if (xmlhttp.status == 200) {\n                try {\n                    params.videos = JSON.parse(xmlhttp.responseText);\n                } catch (err) {\n                    params.videos = { success: false };\n                }\n            } else {\n                params.videos = { success: false };\n            }\n            isYujaConnected = false;\n            // Call the mceYuja function\n            if (params.videos !== undefined && params.videos.success === false) {\n                showAlertMessage(\"Loading...\", 'The YuJa media chooser experienced an error while loading videos.  Please ensure your configuration information is correct and try refreshing the page. If the error persists, please contact YuJa support.');\n                return;\n            }\n\n            if (mediaSelector === null) {\n                mediaSelector = yuja.createMediaSelector(params.videos.data);\n            }\n\n            mediaSelector.onSelect(embedHandler.bind(null, editor));\n\n            mediaSelector.open();\n        }\n    };\n\n\n    var error = false;\n    if (!isYujaConnected) {\n        isYujaConnected = true;\n        // Mount the script that will load the common yuja variables\n        loadScript(params.yujaJsUrl);\n        // Load the videos\n        xmlhttp.open(\"GET\", params.yujaVideosUrl, true);\n        xmlhttp.send();\n        error = true;\n        // Call this function again once complete\n        //yujaConnectedCallback = this.execCommands['mceYuja'].func.bind(this, this, false);\n    } else if (params.videos === undefined || (typeof yuja === \"undefined\" || yuja === undefined)) {\n        showAlertMessage(\"Loading...\", 'The YuJa media chooser is still loading your YuJa content. Try again in a few seconds.');\n        return;\n    }\n\n};\n\n/**\n * Get the setup function for the buttons.\n *\n * \n * @returns {function} The registration function to call within the Plugin.add function.\n */\nimport {get_string as getString} from 'core/str';\nimport { getButtonImage } from 'editor_tiny/utils';\nimport { getTinyMCE } from 'editor_tiny/loader';\nimport {\n    component,\n    buttonName,\n    icon,\n} from './common';\n\nimport { getFpoptions } from './options';\nvar isYujaConnected = false;\nexport const getSetup = async () => {\n    const [\n        buttonTitle,\n        buttonImage,\n        tinyMCE,\n    ] = await Promise.all([\n        getString('buttonTitle', component),\n        getButtonImage('icon', component),\n        getTinyMCE(),\n    ]);\n    //load yuja pack\n    tinyMCE.PluginManager.requireLangPack('yuja');\n\n\n    return (editor) => {\n        // Register the Moodle SVG as an icon suitable for use as a tiny toolbar button.\n        editor.ui.registry.addIcon(icon, buttonImage.html);\n\n        // Register the yujaMedia Button.\n        editor.ui.registry.addButton(buttonName, {\n            icon,\n            tooltip:buttonTitle,\n            onAction: () => handleAction(editor),\n        });\n\n        // Add the yujaMedia Menu Item.\n        // This allows it to be added to a standard menu, or a context menu.\n        editor.ui.registry.addMenuItem(buttonName, {\n            icon,\n            text: buttonTitle,\n            onAction: () => handleAction(editor),\n        });\n    };\n};\n\n"],"names":["handlerLoaded","embedHandler","editor","embedString","arrayofIframe","getContent","split","splitembedString","currentURL","match","auth","URLSearchParams","get","error","forEach","item","index","includes","join","execCommand","showAlertMessage","title","message","$","jQuery","helperIdToCssSelector","id","helperIDExists","length","killToastMessage","$toast","css","display","$idToastContainer","attr","document","body","append","createSingletonToastMessageContainer","styles","push","$toastMesageStyles","head","createSingletonToastMessageStyles","$leftSideBar","$progressBar","$header","$body","newToastId","ID_YUJA_TOAST","$toastContainer","on","setTimeout","find","addClass","opacity","fadeAndKillToastMessage","createToastMessage","handleAction","mediaSelector","params","ltiVersion","undefined","yujaError","xmlhttp","window","XMLHttpRequest","ActiveXObject","onreadystatechange","readyState","DONE","status","videos","JSON","parse","responseText","err","success","isYujaConnected","yuja","createMediaSelector","data","onSelect","bind","open","url","script","yujaJsUrl","createElement","src","documentElement","appendChild","yujaVideosUrl","send","onload","require","OnMessage","event","type","embed","removeClass","addEventListener","attachEvent","location","origin","loadIframe","lti3LoginInitUrl","async","buttonTitle","buttonImage","tinyMCE","Promise","all","component","PluginManager","requireLangPack","ui","registry","addIcon","icon","html","addButton","buttonName","tooltip","onAction","addMenuItem","text"],"mappings":"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"}